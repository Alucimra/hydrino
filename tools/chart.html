<!DOCTYPE html>
<html>
  <head>
    <title>Hello</title>
    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/popper.min.js"></script>
    <script src="./js/popper-utils.min.js"></script>
    <script src="./bootstrap-4.0.0b/js/bootstrap.min.js"></script>
    <script src="./js/Chart.bundle.min.js"></script>
    <link rel="stylesheet" href="./bootstrap-4.0.0b/css/bootstrap.min.css"/>
  </head>
  <body>
    <canvas id="chart" style="height: 500px; width: 800px;"></canvas>
    <div class="container">
      <form>
        <div class="form-group">
          <textarea class="form-control" id="logs" rows=10></textarea>
          <input type="button" id="graph" class="btn" value="Charge Remaining" />
        </div>
        <div class="form-group">
          <label>X</label>
          <input type="text" class="form-control" id="x" />
        </div>
        <div class="form-group">
          <label>Y</label>
          <input type="text" class="form-control" id="y" />
        </div>
      </form>
    </div>
    <script>
      var $chart, chart;
      $(function(){
        $chart = $('#chart');
        //var chart = new Chart($chart[0], {type: 'bubble', data: []});
        $('#graph').click(function(){
          var x = [];
          var y = [];
          var time = 0;
          $.each($('#logs').val().split("\n"), function(i, line){
            var data = line.split("\t");
            if(Number(data[0]) % 2 == 1){
              // odd, so read voltage
              y.push(Number(data[1].match(/=([\d\.]+)v/)[1]));
            } else {
              // even, so read time
              x.push(time);
              time += Number(data[2].match(/: ([\d]+)/)[1]);
            }
          });

          $('#x').val('time <- c(' + x.join(',') + ')');
          $('#y').val('volts <- c(' + y.join(',') + ')');
          if(chart){ chart.destroy(); }

          var data = [];
          $.each(x, function(i, val){
            data.push({x: val, y: y[i]});
          });
          window.data = data;
          window.x = x;
          window.y = y;
          chart = new Chart($chart[0], {type: 'scatter', data: {datasets: [{label: 'Charge Remaining', data: data}]}} );
        });
      });
    </script>
  </body>
</html>
